
@{
    ViewData["Title"] = "客户端";
}

<div id="clientsApp">

    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-white">
                <div class="panel-heading">
                    <div class="panel-title" style="padding:0;"><h4 class="breadcrumb-header">客户端</h4></div>
                </div>
                <div class="panel-body">
                    <el-button type="primary" size="mini" @@click="addClient">添加客户端</el-button>
                    <el-collapse v-model="activeNames" style="margin-top:20px;">
                        <el-collapse-item title="搜索" name="1">
                            <el-form :inline="true" :model="search" ref="searchForm" class="" size="small">
                                <el-form-item label="客户端">
                                    <el-input v-model="search.key" placeholder="标识/名称"></el-input>
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @@click="searchList">查询</el-button>
                                </el-form-item>
                            </el-form>
                        </el-collapse-item>
                    </el-collapse>
                    <div class="table-responsive">
                        <el-table :data="list" style="width: 100%">
                            <el-table-column type="index"
                                             label="#">
                            </el-table-column>
                            <el-table-column prop="clientId"
                                             label="客户端标识">
                            </el-table-column>
                            <el-table-column prop="clientName"
                                             label="客户端名称">
                            </el-table-column>
                            <el-table-column prop="created" :formatter="formatDate" width="200"
                                             label="创建时间">
                            </el-table-column>
                            <el-table-column fixed="right"
                                                 label="操作">
                                    <template slot-scope="scope">

                                        <el-button size="mini" @@click="editClient(scope.row)" plain>编辑</el-button>
                                        <el-button type="danger" size="mini" @@click="deleteClient(scope.row)" plain>删除</el-button>

                                    </template>
                                </el-table-column>
                        </el-table>
                    </div>
                    <el-pagination background @@size-change="handleSizeChange"
                                   @@current-change="handleCurrentChange"
                                   :current-page="search.pageIndex"
                                   :page-sizes="[10, 20, 50, 100]"
                                   :page-size="search.pageSize"
                                   layout="total, sizes, prev, pager, next"
                                   :total="totalCount" style="text-align:right;margin-top:10px;">
                    </el-pagination>
                </div>
            </div>
        </div>
    </div>


</div>


@section Scripts{
    <script>
        var clientsApp = new Vue({
            el: '#clientsApp',
            data: {
                activeNames: ['-1'],
                search: {
                    key: "",
                    pageIndex: 1,
                    pageSize: 10
                },
                totalCount: 0,
                list: []
            },
            methods: {
                handleSizeChange(val) {
                    this.search.pageSize = val;
                    this.loadData();
                },
                handleCurrentChange(val) {
                    this.search.pageIndex = val;
                    this.loadData();
                },
                loadData() {
                    var that = this;
                    $.ajax({
                        url: "/Configuration/QueryClients",
                        type: "post",
                        data: that.search,
                        success: function (response) {
                            console.log(response);
                            if (response.code === 0) {
                                that.list = response.data.clients;
                                that.search.pageIndex = response.data.pageIndex;
                                that.search.pageSize = response.data.pageSize;
                                that.totalCount = response.data.totalCount;
                            } else {

                            }
                        }
                    });
                },
                searchList() {
                    this.loadData();
                },
                formatDate(row, column) {
                    var dt = row[column.property]
                    if (dt === undefined) {
                        return ''
                    }
                    var date = new Date(dt)
                    var Y = date.getFullYear() + '-';
                    var M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
                    var D = (date.getDate() < 10 ? '0' + date.getDate() : date.getDate()) + ' ';
                    var h = (date.getHours() < 10 ? '0' + date.getHours() : date.getHours()) + ':';
                    var m = (date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes()) + ':';
                    var s = (date.getSeconds() < 10 ? '0' + date.getSeconds() : date.getSeconds());
                    return Y + M + D + h + m + s;
                },
                addClient() { },
                editClient() {
                    this.content = "";
                    this.dialogForSendMsg = true;
                },
                deleteClient() {
                    var that = this;
                    this.$confirm('确定删除吗?', '提示', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'error',
                        callback: action => {
                            if (action == 'confirm') {
                                $.ajax({
                                    url: "/",
                                    type: "post",
                                    data: { id: item.id },
                                    success: function (response) {
                                        if (response.code === 0) {
                                            that.loadData();
                                        } else {

                                        }
                                    }
                                });
                            }
                        }
                    });
                }
            },
            mounted: function () {
                var that = this;
                that.loadData();
            }
        });
    </script>
}


